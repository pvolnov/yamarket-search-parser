Yandex Market Parser bitech
====================


### Как это работает
Бот написан на python 3 с использованием Selenium. Во время работы он подключается к selnoid на сервере и в несколько потоков поочередно открывает окна браузера, делает поисковой запрос, потом открывает страницы товаров и собирает от туда информацию о характеристиках продуктов. Всю информацию он выгружает в бд, при перезапуске продолжает работу с места на котором остановился. Черес скрипт `task_upload.py` осуществляется управление парсером: просмотр статуса загрузки, добавление заданий и выгрузка данных. 

### Предварительная настройка
В фале `configs.py` необходмо обновить несколько констант:
```python
db_name = '[название бвзы данных]'
db_login = '[логин для подкоючения]'
db_password = '[пароль]'
db_host = '[IP базы данных]'
db_port = 5432

RU_CAPTCHA_APY_KEY = "[токен от сервиса https://rucaptcha.com/ необходимый для прохода капчей на сайте]"
SELENOID_ADRESS = "[адресс для подключения к selenoid пример: http://127.0.0.1:4444/wd/hub]"
```
[Инструкция по установке](https://4te.me/post/selenium-docker/) на сервере `selenoid`

[Получение RuCaptchaApyKey](https://rucaptcha.com/auth/register)

### Работа с парсером
0.* Если первый раз запускаете парсер с вашей БД выполните `python3 task_upload.py --init` чтобы создать нужные для дальнейше работы таблицы.
1. Поместите в репозиторий проекта csv файл с колонкой `origin_name`.
2. Выполните `python3 task_upload.py -f [название фафла].csv` чтобы добавить все названия в задачу на поиск 
3. Запустите парсер выполнив команду `python3 parser.py` и дождитесь окончания парсинга
4. Можете проверять статус парснга выполняя команду `python3 task_upload.py -s `
5. После окончания парсинга выполните команду `python3 task_upload.py -e [название фафла].csv` чтобы выгрузить результат парсинга. Будут выгружены все товары, название которых было в переданном файле. Будет сгенерирован файл `result.csv`


#### Запуск на сервере 
Для настройки сервера выполните

```bash
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install git python3-pip
git clone https://github.com/Neafiol/yamarket-search-parser
cd yamarket-search-parser
bash ./install.sh
```
