Yandex Market Parser bitech
====================


### Как это работает
Бот написан на python 3 с использованием Selenium. Во время работы он подключается к selnoid на сервере и в несколько потоков поочередно открывает окна браузера, делает поисковой запрос, потом открывает страницы товаров и собирает от туда информацию о характеристиках продуктов. Всю информацию он выгружает в бд, при перезапуске продолжает работу с места на котором остановился. Черес скрипт `task_upload.py` осуществляется управление парсером: просмотр статуса загрузки, добавление заданий и выгрузка данных. 

### Предварительная настройка
В фале `configs.py` необходмо обновить несколько констант:
```python
db_name = '[название базы данных Postges]'
db_login = '[логин для подключения Postges]'
db_password = '[пароль Postges]'
db_host = '[IP базы данных Postges]'
db_port = 5432

db_ms_name = '[название базы данных MSsql]'
db_ms_login = '[логин для подключения MSsql]'
db_ms_password = '[пароль MSsql]'
db_ms_host = '[IP базы данных MSsql]'

RU_CAPTCHA_APY_KEY = "[токен от сервиса https://rucaptcha.com/ необходимый для прохода капчей на сайте]"
SELENOID_ADRESS = "[адресс для подключения к selenoid пример: http://127.0.0.1:4444/wd/hub]"
```
[Инструкция по установке](https://4te.me/post/selenium-docker/) на сервере `selenoid`

[Получение RuCaptchaApyKey](https://rucaptcha.com/auth/register)

### Работа с парсером
0.* Если первый раз запускаете парсер с вашей БД выполните `python3 task_upload.py --init` чтобы создать нужные для дальнейше работы таблицы.
1. Поместите в таблицу `tasks` на сервере mssql список оригенальных названий в колонку `name`.
2. Выполните `python3 task_upload.py -u` чтобы добавить все названия в задачу на поиск 
3. Запустите парсер выполнив команду `python3 parser.py` и дождитесь окончания парсинга, рекомендуется запустить его разово в фоне, если задач нет он будет уходить в мпящий режим
4. Можете проверять статус парснга выполняя команду `python3 task_upload.py -s `
5. После окончания парсинга выполните команду `python3 task_upload.py -e ` чтобы выгрузить результат парсинга. Будут выгружены все товары, название которых было в переданном файле. Будет сгенерирован файл `result.csv` а также добавлены строки в таблицу `result` на сервере MsSQl


#### Запуск на сервере 
Для настройки сервера выполните

```bash
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install git python3-pip
git clone https://github.com/Neafiol/yamarket-search-parser
cd yamarket-search-parser
bash ./install.sh
```
